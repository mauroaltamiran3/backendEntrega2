<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>{{title}}</title>
  <link rel="stylesheet" href="/static/css/normalize.css">
  <link rel="stylesheet" href="/static/css/global.css">
  {{#if style}}
    {{#each style}}
      <link rel="stylesheet" href="/static/css/{{this}}.css">
    {{/each}}
  {{/if}}
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>
  {{> navbar}}

  <main class="main-content">
    {{{body}}}
  </main>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    if (urlParams.get('admin') === 'ok') {
      Swal.fire({
        icon: 'success',
        title: 'Â¡Ahora sos administrador!',
        text: 'Tu rol ha sido actualizado exitosamente.',
        timer: 1500,
        showConfirmButton: false
      }) 
      window.history.replaceState({}, document.title, "/");
    } else if (urlParams.get('user') === 'ok') {
      Swal.fire({
        icon: 'success',
        title: 'Â¡Ahora sos user!',
        text: 'Tu rol ha sido actualizado exitosamente.',
        timer: 1500,
        showConfirmButton: false
      });
      window.history.replaceState({}, document.title, "/");
    }
  </script>
  {{{scripts}}}
  <script>
    const jwtToken = localStorage.getItem('jwtToken');
    const jwtName = localStorage.getItem('jwtUserName');
    const jwtRole = localStorage.getItem('jwtUserRole');
    const jwtPlaceholder = document.getElementById('jwt-navbar-placeholder');
    const sessionLoginLink = document.getElementById('session-login-link');

    if (jwtToken && jwtPlaceholder) {
      jwtPlaceholder.innerHTML = `
        <span class="user">ðŸ‘¤ ${jwtName} (${jwtRole})</span>
        <a href="/jwt/profile" class="nav-link">ðŸ“„ Mi perfil</a>
        <a href="#" class="nav-link" id="jwtLogoutBtn">ðŸšª Cerrar sesiÃ³n</a>
      `;

      if (sessionLoginLink) sessionLoginLink.style.display = 'none';

      document.getElementById('jwtLogoutBtn').addEventListener('click', (e) => {
        e.preventDefault();
        localStorage.removeItem('jwtToken');
        localStorage.removeItem('jwtUserName');
        localStorage.removeItem('jwtUserRole');
        window.location.href = '/';
      });
    }
  </script>
</body>
</html>